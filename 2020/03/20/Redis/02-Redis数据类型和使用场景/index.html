<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Redis/02-Redis数据类型和使用场景 | Hexo</title>
  <meta name="keywords" content="">
  <meta name="description" content="Redis/02-Redis数据类型和使用场景 | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="about">
<meta property="og:url" content="http://yoursite.com/about/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-19T16:29:46.000Z">
<meta property="article:modified_time" content="2020-03-19T16:29:46.804Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/icon.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/icon.jpg" />
</a>
<div class="author">
    <span>John Doe</span>
</div>

<div class="icon">
    
        
        <a title="email" href="mailto:1135038815@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=1135038815&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(13)</small></div></li>
    
        
            
            <li><div data-rel="工具">工具<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    </div>
    <div><a class="about  site_url"  href="/about">关于</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="13">
<input type="hidden" id="yelog_site_word_count" value="21.8k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="以 in: 开头进行全文搜索" />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color2">a</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">b</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a  class="工具 "
           href="/2020/03/19/test/"
           data-tag="a,b"
           data-author="" >
            <span class="post-title" title="test">test</span>
            <span class="post-date" title="2020-03-19 23:39:26">2020/03/19</span>
        </a>
        
        <a  class=""
           href="/2020/03/19/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-03-19 21:24:22">2020/03/19</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/04-Redis%E6%8C%81%E4%B9%85%E5%8C%96/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/04-Redis持久化">Redis/04-Redis持久化</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/01-Redis%E4%BB%8B%E7%BB%8D%E5%8F%8ANIO%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/01-Redis介绍及NIO原理介绍">Redis/01-Redis介绍及NIO原理介绍</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/03-Redis%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/03-Redis使用进阶">Redis/03-Redis使用进阶</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/08-%E5%88%9D%E8%AF%86zk/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/08-初识zk">Redis/08-初识zk</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/02-Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/02-Redis数据类型和使用场景">Redis/02-Redis数据类型和使用场景</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/05-Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8A%E9%AB%98%E5%8F%AF%E7%94%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/05-Redis主从复制及高可用">Redis/05-Redis主从复制及高可用</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/09-zk%E8%BF%9B%E9%98%B6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/09-zk进阶">Redis/09-zk进阶</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/06-%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E5%8F%8ARedis-Cluster/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/06-数据分片及Redis-Cluster">Redis/06-数据分片及Redis-Cluster</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/README/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/README">Redis/README</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/07-Redis%E5%AE%9E%E6%88%98/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/07-Redis实战">Redis/07-Redis实战</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/2020/03/20/Redis/SUMMARY/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis/SUMMARY">Redis/SUMMARY</span>
            <span class="post-date" title="2020-03-20 23:32:59">2020/03/20</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Redis/02-Redis数据类型和使用场景" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Redis/02-Redis数据类型和使用场景</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-02-27 11:15:55'>2020-03-20 23:32</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:3.9k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis数据类型和使用场景"><span class="toc-text">Redis数据类型和使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#二进制安全机制"><span class="toc-text">二进制安全机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string"><span class="toc-text">string</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-字符串"><span class="toc-text">1. 字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#增删改查："><span class="toc-text">增删改查：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字符串类型值的三种底层编码方式"><span class="toc-text">字符串类型值的三种底层编码方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-数值"><span class="toc-text">2. 数值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令-1"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#数值计算："><span class="toc-text">数值计算：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用场景"><span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-位图bitmap"><span class="toc-text">3. 位图bitmap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令-2"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#增删改查：-1"><span class="toc-text">增删改查：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#位运算："><span class="toc-text">位运算：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用场景-1"><span class="toc-text">使用场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#list"><span class="toc-text">list</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用命令-3"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#增删改查：-2"><span class="toc-text">增删改查：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引相关操作："><span class="toc-text">索引相关操作：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#阻塞操作："><span class="toc-text">阻塞操作：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景-2"><span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hash"><span class="toc-text">hash</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用命令-4"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#增删改查：-3"><span class="toc-text">增删改查：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数值计算：-1"><span class="toc-text">数值计算：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景-3"><span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set"><span class="toc-text">set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用命令-5"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#增删改查：-4"><span class="toc-text">增删改查：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#交并差集："><span class="toc-text">交并差集：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#随机事件："><span class="toc-text">随机事件：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景-4"><span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sorted-set"><span class="toc-text">sorted_set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用命令-6"><span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#增删改查：-5"><span class="toc-text">增删改查：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#交并集："><span class="toc-text">交并集：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数值计算：-2"><span class="toc-text">数值计算：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#阻塞操作：-1"><span class="toc-text">阻塞操作：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#排序是怎么实现的，增删改查的速度如何"><span class="toc-text">排序是怎么实现的，增删改查的速度如何</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景-5"><span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通用类型命令"><span class="toc-text">通用类型命令</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Redis数据类型和使用场景"><a href="#Redis数据类型和使用场景" class="headerlink" title="Redis数据类型和使用场景"></a>Redis数据类型和使用场景</h1><h2 id="二进制安全机制"><a href="#二进制安全机制" class="headerlink" title="二进制安全机制"></a>二进制安全机制</h2><p>​    二进制安全的意思就是，redis只关心二进制化的字符串，不关心具体格式，只会以<strong>字节流</strong>存取数据，不会妄图以某种特殊格式解析数据。</p>
<p>​    在进入客户端命令行时，可以通过增加<code>redis-cli --row</code>参数，使redis客户端尝试进行编码后返回。</p>
<h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><h3 id="1-字符串"><a href="#1-字符串" class="headerlink" title="1. 字符串"></a>1. 字符串</h3><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><h5 id="增删改查："><a href="#增删改查：" class="headerlink" title="增删改查："></a>增删改查：</h5><ol>
<li><code>SET key value [expiration EX seconds|PX milliseconds] [NX|XX]</code><ul>
<li><code>set k1 hello EX 10</code>：插入k1键，10秒后过期</li>
<li><code>set k1 hello PX 10</code>：插入k1键，10毫秒后过期</li>
<li><code>set k1 hello NX</code>：只有k1键不存在时，才会设置value值</li>
<li><code>set k1 hello XX</code>：只有k1键存在时，才会设置value值</li>
</ul>
</li>
<li><code>MSET key value [key value ...]</code></li>
<li><code>MSETNX key value [key value ...]</code>：一次设置多组kv，只有在k都不存在时。多组kv中有任意一个key存在，那么整条命令都会失败，即不会设置任何value</li>
<li><code>PSETEX key milliseconds value</code>：和<code>SET key value PX milliseconds</code>一样</li>
<li><code>SETEX key seconds value</code>：和<code>SET key value EX seconds</code>一样</li>
<li><code>SETNX key value</code>：和<code>SET key NX value</code>一样</li>
<li><code>DEL key</code></li>
<li><code>GET key</code></li>
<li><code>MGET key [key ...]</code>：一次获取多个key的value</li>
<li><code>GETSET key</code></li>
<li><code>APPEND key value</code></li>
<li><code>GETRANGE key start end</code><ul>
<li><code>GETRANGE k1 0 4</code>：获取k1的value值中第0到第4共5个字符，双闭区间</li>
<li><code>GETRANGE k1 -5 -1</code>：获取k1的value值中倒数第5到最后一个共5个字符，双闭区间</li>
</ul>
</li>
<li><code>SETRANGE key offset value</code><ul>
<li><code>SETRANGE k1 6 aaaa</code>：把k1键对应的值，从第7个字符开始用<code>aaaa</code>覆盖。比如原来value是<code>hello world</code>，覆盖之后是<code>hello aaaad</code>。如果<code>offset</code>超过值的当前长度，那么值长度会增加，中间空缺的位置用ASCII码中空字符<code>\x00</code>填充</li>
</ul>
</li>
<li><code>STRLEN key</code></li>
</ol>
<h4 id="字符串类型值的三种底层编码方式"><a href="#字符串类型值的三种底层编码方式" class="headerlink" title="字符串类型值的三种底层编码方式"></a>字符串类型值的三种底层编码方式</h4><p>​    通过<code>OBJECT encoding key</code>可以看到指定key的value在底层是什么编码方式。对于字符串类型值，redis有3种编码：</p>
<ul>
<li>int：当值是整数，且可以采用long类型表示时</li>
<li>embstr：当值的长度不大于44个字符时，用embstr编码。embstr编码的对象只有一次内存调用，速度更快，但是只读。当对embstr编码值进行修改时，会先进行编码转换，编程raw编码，再执行修改操作</li>
<li>raw：当值的长度大于44个字符时，或者embstr编码的值发生了修改（如通过<code>append</code>命令）</li>
</ul>
<h3 id="2-数值"><a href="#2-数值" class="headerlink" title="2. 数值"></a>2. 数值</h3><h4 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h4><h5 id="数值计算："><a href="#数值计算：" class="headerlink" title="数值计算："></a>数值计算：</h5><ol>
<li><code>INCR key</code></li>
<li><code>INCRBY key increment</code></li>
<li><code>INCRBYFLOAT key increment</code>：对指定key对应值与increment做加法运算。increment可以是小数或者负数，一旦成功执行该命令后，key对应值编码就会变成embstr，如果value中带有小数点”.”，那么其他int类型命令（如 <code>INCR</code>、<code>DECRBY</code>等）就无法使用了</li>
<li><code>DECR key</code></li>
<li><code>DECRBY key decrement</code></li>
</ol>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p>​    做 [有规定生存时间内的] 计数器，如秒杀中的商品库存、详情页中的点赞和评论数。</p>
<p>​    唯一 id 生成器。</p>
<p>​    在数据不需要强一致、持久化的场景下，使用redis在内存中进行操作，可以规避并发、规避数据库的事务，提升性能降低数据占用磁盘的空间</p>
<h3 id="3-位图bitmap"><a href="#3-位图bitmap" class="headerlink" title="3. 位图bitmap"></a>3. 位图bitmap</h3><h4 id="常用命令-2"><a href="#常用命令-2" class="headerlink" title="常用命令"></a>常用命令</h4><h5 id="增删改查：-1"><a href="#增删改查：-1" class="headerlink" title="增删改查："></a>增删改查：</h5><ol>
<li><code>GETBIT key offset</code>：获取指定key对应value中，位下标是offset的值。返回值不是”0”就是”1”</li>
<li><code>SETBIT key offset value</code></li>
<li><code>BITCOUNT key [start end]</code>：返回从start下标字节开始，到end下标字节结束，这串字节里位上值为“1”的个数</li>
<li><code>BITPOS key bit [start] [end]</code>：<code>bit</code>可以取”0”或”1”值，代表从start下标字节开始end下标字节结束，第一个出现位值是<code>bit</code>的位下标。返回”-1”代表不存在位值等于<code>bit</code></li>
</ol>
<h5 id="位运算："><a href="#位运算：" class="headerlink" title="位运算："></a>位运算：</h5><ol>
<li><code>BITOP operation destkey key [key ...]</code>：对bitmap做运算<ul>
<li><code>BITOP AND destkey key [key ...]</code> ，对一个或多个 <code>key</code> 求逻辑与，并将结果保存到 <code>destkey</code> </li>
<li><code>BITOP OR destkey key [key ...]</code> ，对一个或多个 <code>key</code> 求逻辑或，并将结果保存到 <code>destkey</code> </li>
<li><code>BITOP XOR destkey key [key ...]</code> ，对一个或多个 <code>key</code> 求逻辑异或，并将结果保存到 <code>destkey</code> </li>
<li><code>BITOP NOT destkey key</code> ，对给定 <code>key</code> 求逻辑非，并将结果保存到 <code>destkey</code> </li>
</ul>
</li>
<li><code>BITFIELD key [GET type offset][SET type offset value] [INCRBY type offset increment][OVERFLOW WRAP|SAT|FAIL]</code>：该命令将 Redis 字符串视为一个位数组，并且能够处理具有不同位宽和任意非（必要）对齐偏移量的特定整数字段</li>
</ol>
<p><img src="./pics/bitmap.png" alt="bitmap"></p>
<h4 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h4><ol>
<li><p>有一个用户系统，需要统计用户登录天数，且支持指定时间窗口（如2020年第一个月，618当天 是否登录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> userid用户2020年第1天登录了，设置第0下标位为1</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT userid 0 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> userid用户2020年第16天登录了，设置第15下标位为1</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT userid 15 1</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> userid用户2020年最后一天登录了，设置第364位为1</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT userid 364 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计userid用户一年登录天数</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT userid</span><br><span class="line">3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计userid用户最后一个月登录天数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 334位代表12月第一天</span></span><br><span class="line">127.0.0.1:6379&gt; GETBIT userid 334</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 335位代表12月第二天</span></span><br><span class="line">127.0.0.1:6379&gt; GETBIT userid 335</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计最后29天总登录天数。-1到-4一共是32个字节，由于最后一个字节的8位只用了前5位（365/8=45余5），因此这32个字节其实只有29个是有效的</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT userid -4 -1</span><br><span class="line">1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将三个返回值累加就是该用户最后一个月的总登录天数</span></span><br></pre></td></tr></table></figure>

<p>数据结构：每条数据的key是用户唯一表示，值的每一位代表不同的状态</p>
<p><img src="./pics/bitmap-1.png" alt="bitmap-1"></p>
</li>
<li><p>有一个大型电商，618要做活动，在当天登录了的用户会送礼物，请预估需要准备多少货</p>
<p>​    用户分为僵尸用户和活跃用户等，对于僵尸用户，登录的概率是极小的，因此不可能数据库里有多少用户就备多少数量的货</p>
<p>​    这个问题的本质是支持随机窗口的活跃用户统计，统计出近期内一段时间内登陆的用户数（需要进行去重，因为一个用户只会发放一份礼物），然后这个活跃用户数再扩一定的百分比（比如扩个30%、50%），就是预估的备货数量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 10代表某个特定用户的id，1代表这个用户登陆了</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT 20200101 10 1</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 15号用户在2020 01 01日登陆了</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT 20200101 15 1</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 15号用户在2020 01 02日又登陆了</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT 20200102 15 1</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 33号用户在2020 01 02日登陆了</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT 20200102 33 1</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计这两天共有多少用户进行了登陆，做or运算</span></span><br><span class="line">127.0.0.1:6379&gt; BITOP or totalcount 20200101 20200102</span><br><span class="line">5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取计算结果中共有多少位值为1，即为总登录用户数</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT totalcount</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>数据结构：每条数据的key代表日期，值的每一位对应一个用户</p>
<p><img src="./pics/bitmap-2.jpg" alt="bitmap-2"></p>
</li>
</ol>
<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><p>​    <font color='red'>存取有序</font>、不去重、集合内不排序</p>
<h3 id="常用命令-3"><a href="#常用命令-3" class="headerlink" title="常用命令"></a>常用命令</h3><p>​    list命令中，有“R”开头的命令，代表Right；有“L”开头的命令，代表Left或者List；有“B”开头的命令，代表Block</p>
<h4 id="增删改查：-2"><a href="#增删改查：-2" class="headerlink" title="增删改查："></a>增删改查：</h4><ol>
<li><code>LPUSH key value [value ...]</code></li>
<li><code>RPUSH key value [value ...]</code></li>
<li><code>LPUSHX key value</code>：只在存在key时成功</li>
<li><code>RPUSHX key valu</code></li>
<li><code>LINSERT key BEFORE|AFTER pivot value</code>：在指定位置插入元素。<ul>
<li><code>LINSERT k1 before e 1</code>：从左往右遍历list，在第一个值是“e”的前面插入元素值”1”</li>
<li><code>LINSERT k1 after 1 2</code></li>
</ul>
</li>
<li><code>LREM key count value</code>：count可以是正数，代表从左往右数count个数的value进行移除；count可以是负数，代表从右往左数<ul>
<li><code>LREM k1 2 a</code>：从左往右依次删除2个值为“a”的元素，返回删除元素的个数</li>
<li><code>LREM k1 -2 b</code>：从右往左删2个”b”元素</li>
</ul>
</li>
<li><code>LTRIM key start stop</code>：删除 start 索引前面的和 stop 索引后面的元素。索引支持正负值<ul>
<li><code>lrange k1 1 -2</code>：删除k1首尾两个元素</li>
</ul>
</li>
<li><code>LPOP key</code>：</li>
<li><code>RPOP key</code>：</li>
<li><code>RPOPLPUSH source destination</code>：移除 source key对应list中的最右边一个元素，并把移除的元素值加到 destination key对应list的左边</li>
<li><code>LRANGE key start stop</code>：返回 start 索引开始，stop 索引结束的列表，索引支持正负</li>
<li><code>LLEN key</code></li>
</ol>
<h4 id="索引相关操作："><a href="#索引相关操作：" class="headerlink" title="索引相关操作："></a>索引相关操作：</h4><ol>
<li><code>LINDEX key index</code></li>
<li><code>LSET key index value</code>：</li>
</ol>
<h4 id="阻塞操作："><a href="#阻塞操作：" class="headerlink" title="阻塞操作："></a>阻塞操作：</h4><ol>
<li><code>BLPOP key [key ...] timeout</code></li>
<li><code>BRPOP key [key ...] timeout</code></li>
<li><code>BRPOPLPUSH source destination timeout</code></li>
</ol>
<h3 id="使用场景-2"><a href="#使用场景-2" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>同向命令（<code>lpush</code>、<code>lpop</code>）实现栈</li>
<li>反向命令（<code>lpush</code>、<code>rpop</code>）实现队列</li>
<li>索引操作（<code>LINDEX</code>、<code>LSET</code>）实现数组</li>
<li>阻塞操作（<code>BLPOP</code>、<code>LPOP</code>）实现阻塞、先进先出的单播队列</li>
</ul>
<h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><h3 id="常用命令-4"><a href="#常用命令-4" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="增删改查：-3"><a href="#增删改查：-3" class="headerlink" title="增删改查："></a>增删改查：</h4><ol>
<li><p><code>HSET key field value</code></p>
</li>
<li><p><code>HMSET key field value [field value ...]</code></p>
</li>
<li><p><code>HSETNX key field value</code>：field不存在时才会成功</p>
</li>
<li><p><code>HDEL key field [field ...]</code></p>
</li>
<li><p><code>HGET key field</code></p>
</li>
<li><p><code>HMGET key field [field ...]</code></p>
</li>
<li><p><code>HKEYS</code></p>
</li>
<li><p><code>HVALS</code></p>
</li>
<li><p><code>HGETALL</code></p>
</li>
<li><p><code>HSCAN key cursor [MATCH pattern] [COUNT count]</code>：返回从 cursor 开始的部分数据及下一次 cursor 位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> keys *，在数据量大的情况下会阻塞很久时间</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line"> 1) "[[kkalsd"</span><br><span class="line"> 2) "k0"</span><br><span class="line"> 3) "czwspk"</span><br><span class="line"> 4) "k"</span><br><span class="line"> 5) "k1"</span><br><span class="line"> 6) "xx"</span><br><span class="line"> 7) "test"</span><br><span class="line"> 8) "a"</span><br><span class="line"> 9) "c"</span><br><span class="line">10) "k2"</span><br><span class="line">11) "mykey"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 SCAN 命令分批获取</span></span><br><span class="line">127.0.0.1:6379&gt; SCAN 0 count 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回下一个key的cursor</span></span><br><span class="line">1) "2"</span><br><span class="line">2) 1) "[[kkalsd"</span><br><span class="line">   2) "k0"</span><br><span class="line">   3) "c"</span><br><span class="line">127.0.0.1:6379&gt; SCAN 2 count 3</span><br><span class="line">1) "10"</span><br><span class="line">2) 1) "k"</span><br><span class="line">   2) "k1"</span><br><span class="line">   3) "xx"</span><br><span class="line">127.0.0.1:6379&gt; SCAN 10 count 6</span><br><span class="line"><span class="meta">#</span><span class="bash"> cursor 归零，代表keys遍历完了</span></span><br><span class="line">1) "0"</span><br><span class="line">2) 1) "test"</span><br><span class="line">   2) "czwspk"</span><br><span class="line">   3) "k2"</span><br><span class="line">   4) "a"</span><br><span class="line">   5) "mykey"</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>HEXISTS key field</code>：返回值“1”代表存在，“0”代表不存在</p>
</li>
<li><p><code>HLEN key</code></p>
</li>
<li><p><code>HSTRLEN key field</code></p>
</li>
</ol>
<h4 id="数值计算：-1"><a href="#数值计算：-1" class="headerlink" title="数值计算："></a>数值计算：</h4><ol>
<li><p><code>HINCRBY key field increment</code>：increment可以是负数</p>
</li>
<li><p><code>HINCRBYFLOAT key field increment</code></p>
</li>
</ol>
<h3 id="使用场景-3"><a href="#使用场景-3" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>对field进行数值计算，适用于点赞数、收藏数</li>
<li><code>HGETALL</code>一次获取全部键值，适用于详情页各种字段值</li>
</ul>
<h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>​        <font color='red'>去重</font>、集合内不排序、存取无序</p>
<h3 id="常用命令-5"><a href="#常用命令-5" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="增删改查：-4"><a href="#增删改查：-4" class="headerlink" title="增删改查："></a>增删改查：</h4><ol>
<li><code>SADD key member [member ...]</code></li>
<li><code>SREM key member [member ...]</code></li>
<li><code>SMOVE source destination member</code></li>
<li><code>SMEMBERS key</code>：返回set中所有值。当数据很大时，影响主机网卡性能和吞吐量。如果要使用该功能，最好把用这个功能的redis单独放到几台服务器上，这几台服务器上不跑其它服务</li>
<li><code>SCARD key</code>：获取set元素个数</li>
<li><code>SISMEMBER key member</code></li>
<li><code>SSCAN key cursor [MATCH pattern] [COUNT count]</code></li>
</ol>
<h4 id="交并差集："><a href="#交并差集：" class="headerlink" title="交并差集："></a>交并差集：</h4><ol>
<li><code>SINTER key [key ...]</code>和<code>SINTERSTORE destination key [key ...]</code>：多个key对应set间取交集。命令中有”STORE”代表存储，”destination”是存储到哪个key里</li>
<li><code>SUNION key [key ...]</code>和<code>SUNIONSTORE destination key [key ...]</code>：取并集</li>
<li><code>SDIFF key [key ...]</code>和<code>SDIFFSTORE destination key [key ...]</code>：差集，方向通过key顺序来实现<ul>
<li><code>SDIFF k1 k2</code>：k1 - k2的差集</li>
<li><code>SDIFF k2 k1</code>：k2 - k1的差集，和上面的结果不一样</li>
</ul>
</li>
</ol>
<h4 id="随机事件："><a href="#随机事件：" class="headerlink" title="随机事件："></a>随机事件：</h4><ol>
<li><code>SRANDMEMBER key [count]</code>：count代表随记取出元素的个数。为正数则表示不会重复，为负数表示可以重复</li>
<li><code>SPOP key [count]</code>：这个count不支持负数</li>
</ol>
<h3 id="使用场景-4"><a href="#使用场景-4" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li><p>基于随机事件，可以实现抽奖</p>
<p>​    抽奖分好多种：</p>
<ul>
<li><p>人数大于礼物数</p>
<ul>
<li>可重复：<code>SRANDMEMBER k1 3</code>，k1中存人的唯一标识，3是礼物数</li>
<li>不可重复：<code>SRANDMEMBER k1 -3</code></li>
</ul>
</li>
<li><p>礼物数大于人数，每人可获得多个礼物</p>
<p><code>SRANDMEMBER k1 -100</code>，k1中存人的唯一标识，即时k1中没有100个元素，也会抽出100个人</p>
</li>
<li><p>分阶段抽，不重复</p>
<p>第一阶段抽3个人，抽中的人不参与第二阶段抽奖：<code>SPOP k1 3</code>；</p>
<p>第二阶段抽1人：<code>SPOP k1 1</code></p>
</li>
</ul>
</li>
<li><p>通过交并差集，实现关注模型中，可能认识的人</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用户a，认识 a b c</span></span><br><span class="line">127.0.0.1:6379&gt; SADD a a b c </span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户b， 认识 a b c d</span></span><br><span class="line">127.0.0.1:6379&gt; SADD b a b c d</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户c， 认识 a b c d</span></span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; SADD c a b c d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 求用户a可能认识的人</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. 将用户a认识的 b 和 c取并集</span></span><br><span class="line">127.0.0.1:6379&gt; SINTERSTORE bc b c</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta">#</span><span class="bash">  2. 将1.结果与a 取差集</span></span><br><span class="line">127.0.0.1:6379&gt; SDIFF bc a</span><br><span class="line">1) "d"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果是 用户a可能认识 d</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="sorted-set"><a href="#sorted-set" class="headerlink" title="sorted_set"></a>sorted_set</h2><p>​    <font color='red'>去重、集合内按分值排序</font>、存取无序。物理内存左小右大</p>
<p>​    分三个维度，成员、分值、排名</p>
<h3 id="常用命令-6"><a href="#常用命令-6" class="headerlink" title="常用命令"></a>常用命令</h3><p>​    因为”S”开头的命令被set用掉了，所以sorted_set命令开头的字母就改成了最后一个字母“Z”</p>
<h4 id="增删改查：-5"><a href="#增删改查：-5" class="headerlink" title="增删改查："></a>增删改查：</h4><ol>
<li><p><code>ZADD key [NX|XX] [CH] [INCR] score member [score member ...]</code></p>
<ul>
<li><code>NX</code>：只有在成员不存在时操作才会成功</li>
<li><code>XX</code>：只有在成员存在时操作才会成功</li>
<li><code>CH</code>：当没有<code>CN</code>时候，<code>ZADD</code>会返回新添加的成员数。当加上<code>CN</code>后，返回被修改的成员数</li>
<li><code>INCR</code>：如果原来存在指定的 member，则将新的 socre与原来的 score 进行加法操作，而不是用新的 score更新原来的 score</li>
</ul>
</li>
<li><p><code>ZPOPMAX key [count]</code></p>
</li>
<li><p><code>ZPOPMIN key [count]</code></p>
</li>
<li><p><code>ZREM key member [member ...]</code></p>
</li>
<li><p><code>ZREMRANGEBYLEX key min max</code>：带有<code>LEX</code>的命令，只有当 sorted_set 中所有成员 score 相等时才有用。删除符合 “成员区间”的成员</p>
<blockquote>
<p>“成员区间” 对应命令中的 min 和 max，规则如下：</p>
<p>min 为 “-“ 代表从0下标开始，闭区间，包括0下标</p>
<p>max 为 “+” 代表到最后一个元素为止，闭区间</p>
<p>“(“ 代表开区间</p>
<p>“[“ 代表封区间</p>
</blockquote>
<p>示例：</p>
<p><code>v1</code>、<code>v2</code>、<code>v3</code>、<code>v4</code>成员 score 一样</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANGE k1 0 -1 withscores</span><br><span class="line">1) "v1"</span><br><span class="line">2) "1"</span><br><span class="line">3) "v2"</span><br><span class="line">4) "1"</span><br><span class="line">5) "v3"</span><br><span class="line">6) "1"</span><br><span class="line">7) "v4"</span><br><span class="line">8) "1"</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ZREMRANGEBYLEX k1 - +</code>：删除全部成员</li>
<li><code>ZREMRANGEBYLEX k1 - (v2</code>：删除 “v1”</li>
<li><code>ZREMRANGEBYLEX k1 - [v2</code>：删除 “v1”和”v2”</li>
<li><code>ZREMRANGEBYLEX k2 [v2 +</code>：删除 “v2”、”v3” 和 “v4”</li>
</ul>
</li>
<li><p><code>ZREMRANGEBYRANK key start stop</code>：删除符合 rank 区间的成员</p>
</li>
<li><p><code>ZREMRANGEBYSCORE key min max</code>：删除符合 score 区间的成员</p>
</li>
<li><p><code>ZSCORE key member</code></p>
</li>
<li><p><code>ZCOUNT key min max</code>：返回 score 符合区间的成员个数</p>
</li>
<li><p><code>ZLEXCOUNT key min max</code></p>
</li>
<li><p><code>ZCARD key</code></p>
</li>
<li><p><code>ZSCAN key cursor [MATCH pattern] [COUNT count]</code></p>
<p>sorted_set 命令一般是按 score 从小到大的顺序返回，以下命令支持加<code>PRV</code>，使返回内容按照 score 从大到小顺序</p>
</li>
<li><p><code>Z[REV]RANGE  key start stop [WITHSCORES]</code></p>
</li>
<li><p><code>Z[REV]RANGEBYLEX key min max [LIMIT offset count]</code></p>
<ul>
<li><code>offset</code>：下标偏移量，即跳过前 <code>offset</code> 个数成员</li>
<li><code>count</code>：返回的最大成员个数</li>
</ul>
<p><code>offset</code> 和 <code>count</code> 其实是做分页用的</p>
</li>
<li><p><code>Z[REV]RANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code></p>
</li>
<li><p><code>Z[REV]RANK key member</code>：返回 key 对应 sorted_set 中指定 成员的 rank 排名</p>
</li>
</ol>
<h4 id="交并集："><a href="#交并集：" class="headerlink" title="交并集："></a>交并集：</h4><p>​    在取交集、并集的时候，和 set 不同， sorted_set 必须把结果进行存储。交集、并集操作是对 set 中成员进行操作的， 对于成员各自的 score ，需要给出结果中成员的 score 计算方式，因此有<code>WEIGHTS</code>和<code>AGGREGATE</code>选项。</p>
<blockquote>
<p>例：成员 ryan 存在于k1 和 k2 所对应 set 中，ryan 在 k1 中的 score 是100，在 k2 中的 score 是 80。</p>
</blockquote>
<ol>
<li><code>ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</code>：交集<ul>
<li><code>ZINTERSTORE interkey 2 k1 k2 weights 1 0.5 AGGREGATE  SUM</code>：交集中 ryan 的 score是 100 * 1 + 80 * 0.5 = 150</li>
</ul>
</li>
<li><code>ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</code>：并集</li>
</ol>
<h4 id="数值计算：-2"><a href="#数值计算：-2" class="headerlink" title="数值计算："></a>数值计算：</h4><ol>
<li><code>ZINCRBY key increment member</code></li>
</ol>
<h4 id="阻塞操作：-1"><a href="#阻塞操作：-1" class="headerlink" title="阻塞操作："></a>阻塞操作：</h4><ol>
<li><code>BZPOPMAX key [key ...] timeout</code></li>
<li><code>BZPOPMIN key [key ...] timeout</code></li>
</ol>
<h3 id="排序是怎么实现的，增删改查的速度如何"><a href="#排序是怎么实现的，增删改查的速度如何" class="headerlink" title="排序是怎么实现的，增删改查的速度如何"></a>排序是怎么实现的，增删改查的速度如何</h3><p>​    跳表实现，在数据量较大时候，相对于树结构（如红黑树），增删改查平均效率是最优的</p>
<h3 id="使用场景-5"><a href="#使用场景-5" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>基于排序特性，适合做排行榜，比如QQ音乐的乐曲热度排行榜</li>
</ul>
<p>​    </p>
<h2 id="通用类型命令"><a href="#通用类型命令" class="headerlink" title="通用类型命令"></a>通用类型命令</h2><ul>
<li><p><code>OBJECT subcommand [arguments [arguments ...]]</code></p>
<p>subcommand可以是以下命令：</p>
<ul>
<li><code>OBJECT encoding key</code>：查看key对应值的底层编码方式</li>
<li><code>OBJECT refcount key</code>：返回指定key对应值的被引用的次数，常用于调试</li>
<li><code>OBJECT idletime key</code>：返回指定key对应值自被存储之后空闲(没有读写操作的请求)的时间，单位为秒</li>
</ul>
</li>
<li><p><code>TYPE key</code>：查看键对应值的类型，这个类型信息存储在key中。如果一个命令不在指定key对应值类型所支持的命令范围内，会直接返回错误，而不是执行报错后返回，提升性能</p>
</li>
</ul>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 1135038815@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Redis/02-Redis数据类型和使用场景</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">3.9k</span></p>
    <p><span class="copy-title">发布时间:</span>2020-03-20, 23:32:59</p>
    <p><span class="copy-title">最后更新:</span>2020-02-27, 11:15:55</p>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2020-2024 Ryan</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#a','#b',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
